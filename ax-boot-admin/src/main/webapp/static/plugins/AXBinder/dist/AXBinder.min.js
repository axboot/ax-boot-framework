!function(global,factory){"object"==typeof exports&&exports&&"string"!=typeof exports.nodeName?factory(exports):"function"==typeof define&&define.amd?define(["exports"],factory):(global.Mustache={},factory(global.Mustache))}(this,function(mustache){function isFunction(object){return"function"==typeof object}function typeStr(obj){return isArray(obj)?"array":typeof obj}function escapeRegExp(string){return string.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function hasProperty(obj,propName){return null!=obj&&"object"==typeof obj&&propName in obj}function testRegExp(re,string){return regExpTest.call(re,string)}function isWhitespace(string){return!testRegExp(nonSpaceRe,string)}function escapeHtml(string){return String(string).replace(/[&<>"'\/]/g,function(s){return entityMap[s]})}function parseTemplate(template,tags){function stripSpace(){if(hasTag&&!nonSpace)for(;spaces.length;)delete tokens[spaces.pop()];else spaces=[];hasTag=!1,nonSpace=!1}function compileTags(tagsToCompile){if("string"==typeof tagsToCompile&&(tagsToCompile=tagsToCompile.split(spaceRe,2)),!isArray(tagsToCompile)||2!==tagsToCompile.length)throw new Error("Invalid tags: "+tagsToCompile);openingTagRe=new RegExp(escapeRegExp(tagsToCompile[0])+"\\s*"),closingTagRe=new RegExp("\\s*"+escapeRegExp(tagsToCompile[1])),closingCurlyRe=new RegExp("\\s*"+escapeRegExp("}"+tagsToCompile[1]))}if(!template)return[];var openingTagRe,closingTagRe,closingCurlyRe,sections=[],tokens=[],spaces=[],hasTag=!1,nonSpace=!1;compileTags(tags||mustache.tags);for(var start,type,value,chr,token,openSection,scanner=new Scanner(template);!scanner.eos();){if(start=scanner.pos,value=scanner.scanUntil(openingTagRe))for(var i=0,valueLength=value.length;valueLength>i;++i)chr=value.charAt(i),isWhitespace(chr)?spaces.push(tokens.length):nonSpace=!0,tokens.push(["text",chr,start,start+1]),start+=1,"\n"===chr&&stripSpace();if(!scanner.scan(openingTagRe))break;if(hasTag=!0,type=scanner.scan(tagRe)||"name",scanner.scan(whiteRe),"="===type?(value=scanner.scanUntil(equalsRe),scanner.scan(equalsRe),scanner.scanUntil(closingTagRe)):"{"===type?(value=scanner.scanUntil(closingCurlyRe),scanner.scan(curlyRe),scanner.scanUntil(closingTagRe),type="&"):value=scanner.scanUntil(closingTagRe),!scanner.scan(closingTagRe))throw new Error("Unclosed tag at "+scanner.pos);if(token=[type,value,start,scanner.pos],tokens.push(token),"#"===type||"^"===type)sections.push(token);else if("/"===type){if(openSection=sections.pop(),!openSection)throw new Error('Unopened section "'+value+'" at '+start);if(openSection[1]!==value)throw new Error('Unclosed section "'+openSection[1]+'" at '+start)}else"name"===type||"{"===type||"&"===type?nonSpace=!0:"="===type&&compileTags(value)}if(openSection=sections.pop())throw new Error('Unclosed section "'+openSection[1]+'" at '+scanner.pos);return nestTokens(squashTokens(tokens))}function squashTokens(tokens){for(var token,lastToken,squashedTokens=[],i=0,numTokens=tokens.length;numTokens>i;++i)token=tokens[i],token&&("text"===token[0]&&lastToken&&"text"===lastToken[0]?(lastToken[1]+=token[1],lastToken[3]=token[3]):(squashedTokens.push(token),lastToken=token));return squashedTokens}function nestTokens(tokens){for(var token,section,nestedTokens=[],collector=nestedTokens,sections=[],i=0,numTokens=tokens.length;numTokens>i;++i)switch(token=tokens[i],token[0]){case"#":case"^":collector.push(token),sections.push(token),collector=token[4]=[];break;case"/":section=sections.pop(),section[5]=token[2],collector=sections.length>0?sections[sections.length-1][4]:nestedTokens;break;default:collector.push(token)}return nestedTokens}function Scanner(string){this.string=string,this.tail=string,this.pos=0}function Context(view,parentContext){this.view=view,this.cache={".":this.view,"@each":function(){var returns=[];for(var k in this)returns.push({"@key":k,"@value":this[k]});return returns}},this.parent=parentContext}function Writer(){this.cache={}}var objectToString=Object.prototype.toString,isArray=Array.isArray||function(object){return"[object Array]"===objectToString.call(object)},regExpTest=RegExp.prototype.test,nonSpaceRe=/\S/,entityMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},whiteRe=/\s*/,spaceRe=/\s+/,equalsRe=/\s*=/,curlyRe=/\s*\}/,tagRe=/#|\^|\/|>|\{|&|=|!/;Scanner.prototype.eos=function(){return""===this.tail},Scanner.prototype.scan=function(re){var match=this.tail.match(re);if(!match||0!==match.index)return"";var string=match[0];return this.tail=this.tail.substring(string.length),this.pos+=string.length,string},Scanner.prototype.scanUntil=function(re){var match,index=this.tail.search(re);switch(index){case-1:match=this.tail,this.tail="";break;case 0:match="";break;default:match=this.tail.substring(0,index),this.tail=this.tail.substring(index)}return this.pos+=match.length,match},Context.prototype.push=function(view){return new Context(view,this)},Context.prototype.lookup=function(name){var value,cache=this.cache;if(cache.hasOwnProperty(name))value=cache[name];else{for(var names,index,context=this,lookupHit=!1;context;){if(name.indexOf(".")>0)for(value=context.view,names=name.split("."),index=0;null!=value&&index<names.length;)index===names.length-1&&(lookupHit=hasProperty(value,names[index])),value=value[names[index++]];else value=context.view[name],lookupHit=hasProperty(context.view,name);if(lookupHit)break;context=context.parent}cache[name]=value}return isFunction(value)&&(value=value.call(this.view)),value},Writer.prototype.clearCache=function(){this.cache={}},Writer.prototype.parse=function(template,tags){var cache=this.cache,tokens=cache[template];return null==tokens&&(tokens=cache[template]=parseTemplate(template,tags)),tokens},Writer.prototype.render=function(template,view,partials){var tokens=this.parse(template),context=view instanceof Context?view:new Context(view);return this.renderTokens(tokens,context,partials,template)},Writer.prototype.renderTokens=function(tokens,context,partials,originalTemplate){for(var token,symbol,value,buffer="",i=0,numTokens=tokens.length;numTokens>i;++i)value=void 0,token=tokens[i],symbol=token[0],"#"===symbol?value=this.renderSection(token,context,partials,originalTemplate):"^"===symbol?value=this.renderInverted(token,context,partials,originalTemplate):">"===symbol?value=this.renderPartial(token,context,partials,originalTemplate):"&"===symbol?value=this.unescapedValue(token,context):"name"===symbol?value=this.escapedValue(token,context):"text"===symbol&&(value=this.rawValue(token)),void 0!==value&&(buffer+=value);return buffer},Writer.prototype.renderSection=function(token,context,partials,originalTemplate){function subRender(template){return self.render(template,context,partials)}var self=this,buffer="",value=context.lookup(token[1]);if(value){if(isArray(value))for(var j=0,valueLength=value.length;valueLength>j;++j)value[j]["@i"]=j,value[j]["@first"]=0===j,buffer+=this.renderTokens(token[4],context.push(value[j]),partials,originalTemplate);else if("object"==typeof value||"string"==typeof value||"number"==typeof value)buffer+=this.renderTokens(token[4],context.push(value),partials,originalTemplate);else if(isFunction(value)){if("string"!=typeof originalTemplate)throw new Error("Cannot use higher-order sections without the original template");value=value.call(context.view,originalTemplate.slice(token[3],token[5]),subRender),null!=value&&(buffer+=value)}else buffer+=this.renderTokens(token[4],context,partials,originalTemplate);return buffer}},Writer.prototype.renderInverted=function(token,context,partials,originalTemplate){var value=context.lookup(token[1]);return!value||isArray(value)&&0===value.length?this.renderTokens(token[4],context,partials,originalTemplate):void 0},Writer.prototype.renderPartial=function(token,context,partials){if(partials){var value=isFunction(partials)?partials(token[1]):partials[token[1]];return null!=value?this.renderTokens(this.parse(value),context,partials,value):void 0}},Writer.prototype.unescapedValue=function(token,context){var value=context.lookup(token[1]);return null!=value?value:void 0},Writer.prototype.escapedValue=function(token,context){var value=context.lookup(token[1]);return null!=value?mustache.escape(value):void 0},Writer.prototype.rawValue=function(token){return token[1]},mustache.name="mustache.js",mustache.version="2.1.3",mustache.tags=["{{","}}"];var defaultWriter=new Writer;mustache.clearCache=function(){return defaultWriter.clearCache()},mustache.parse=function(template,tags){return defaultWriter.parse(template,tags)},mustache.render=function(template,view,partials){if("string"!=typeof template)throw new TypeError('Invalid template! Template should be a "string" but "'+typeStr(template)+'" was given as the first argument for mustache#render(template, view, partials)');return defaultWriter.render(template,view,partials)},mustache.to_html=function(template,view,partials,send){var result=mustache.render(template,view,partials);return isFunction(send)?void send(result):result},mustache.escape=escapeHtml,mustache.Scanner=Scanner,mustache.Context=Context,mustache.Writer=Writer});var AXBinder=function(){function get_type(O){var typeName;return null!=O&&O==O.window?typeName="window":O&&1==O.nodeType?typeName="element":O&&11==O.nodeType?typeName="fragment":"undefined"==typeof O?typeName="undefined":"[object Object]"==_toString.call(O)?typeName="object":"[object Array]"==_toString.call(O)?typeName="array":"[object String]"==_toString.call(O)?typeName="string":"[object Number]"==_toString.call(O)?typeName="number":"[object NodeList]"==_toString.call(O)?typeName="nodelist":"function"==typeof O&&(typeName="function"),typeName}var _toString=Object.prototype.toString,klass=function(){this.model={},this.tmpl={},this.view_target=null,this.change_trigger={},this.click_trigger={},this.update_trigger={},this.onerror=null};return klass.prototype.set_model=function(model,view_target){return this.model=model,!this.view_target&&view_target?(this.view_target=view_target,this._binding()):this._binding("update"),this},klass.prototype._binding=function(isupdate){var _this=this;this.view_target.find("[data-ax-path]").each(function(){var val,dom=$(this),data_path=dom.attr("data-ax-path"),this_type=(this.type||"").toLowerCase();try{val=Function("","return this."+data_path+";").call(_this.model)}catch(e){_this.onerror&&_this.onerror("not found target [model."+data_path+"]")}_this.set_els_value(this,this.tagName.toLowerCase(),this_type,val||"",data_path)}),"undefined"==typeof isupdate?this.view_target.find("[data-ax-repeat]").each(function(){var dom=$(this),data_path=dom.attr("data-ax-repeat"),repeat_idx=dom.attr("data-ax-repeat-idx");"undefined"==typeof _this.tmpl[data_path]&&(_this.tmpl[data_path]={}),"undefined"!=typeof repeat_idx?_this.tmpl[data_path][repeat_idx]={container:dom,content:dom.find("script").html()}:_this.tmpl[data_path][0]={container:dom,content:dom.find("script").html()},dom.empty()}):this.view_target.find("[data-ax-repeat]").each(function(){var dom=$(this);dom.empty().show()}),this.view_target.find("[data-ax-path]").unbind("change.axbinder").bind("change.axbinder",function(e){var i,checked,dom=$(e.target),data_path=dom.attr("data-ax-path"),origin_value=Function("","return this."+data_path+";").call(_this.model),this_type=(this.type||"").toLowerCase(),value_type=get_type(origin_value),setAllow=!0,hasItem=!1,new_value=[];if(("object"==value_type||"array"==value_type)&&(setAllow=!1),"checkbox"==this_type){if(_this.view_target.find('[data-ax-path="'+data_path+'"]').length>1){for("array"!=get_type(origin_value)&&(origin_value="undefined"==typeof origin_value||""==origin_value?[]:[].concat(origin_value)),i=origin_value.length,hasItem=!1,checked=this.checked;i--;)origin_value[i]==this.value&&(hasItem=!0);if(checked)hasItem||origin_value.push(this.value);else{for(i=origin_value.length;i--;)origin_value[i]==this.value||new_value.push(origin_value[i]);origin_value=new_value}}else origin_value=this.checked?this.value:"";Function("val","this."+data_path+" = val;").call(_this.model,origin_value),_this.change(data_path,{el:this,jquery:dom,tagname:this.tagName.toLowerCase(),value:origin_value})}else setAllow&&(Function("val","this."+data_path+" = val;").call(_this.model,this.value),_this.change(data_path,{el:this,jquery:dom,tagname:this.tagName.toLowerCase(),value:this.value}))}),this.view_target.find("[data-ax-path]").unbind("blur.axbinder").bind("blur.axbinder",function(e){$(e.target).trigger("change")});var callBack;for(var tk in _this.tmpl){for(var ix in _this.tmpl[tk])this.print_tmpl(tk,_this.tmpl[tk][ix],"isInit");if(callBack=this.update_trigger[tk]){var that={repeat_path:tk,tmpl:_this.tmpl[tk],list:Function("","return this."+tk+";").call(this.model)};callBack.call(that,that)}}},klass.prototype.set_els_value=function(el,tagname,type,value,data_path,callChange){value="undefined"==typeof value?[]:[].concat(value);var options,i;if("input"==tagname)if("checkbox"==type||"radio"==type){i=value.length;var checked=!1;if(i>0)for(;i--;)"undefined"!=typeof value[i]&&el.value===value[i].toString()&&(checked=!0);el.checked=checked}else el.value=value.join("");else if("select"==tagname){options=el.options,i=options.length;for(var vi,option_matched=!1;i--;){for(vi=value.length;vi--;)if("undefined"!=typeof value[vi]&&options[i].value===value[vi].toString()){options[i].selected=!0,option_matched=!0;break}if(option_matched)break}option_matched||(options[0]?(options[0].selected=!0,Function("val","this."+data_path+" = val;").call(this.model,options[0].value)):Function("val","this."+data_path+" = val;").call(this.model,"")),window.AXSelect&&$("undefined"!=typeof value&&el).bindSelectSetValue(value[value.length-1])}else"textarea"==tagname?el.value=value.join("")||"":el.innerText?el.innerText=value.join(""):el.innerHTML=value.join("");return callChange&&this.change(data_path,{el:el,tagname:tagname,value:value}),this},klass.prototype.set=function(data_path,value){var obj_type,i,_this=this,this_type=(this.type||"").toLowerCase();if(Function("val","this."+data_path+" = val;").call(this.model,value),obj_type=get_type(value),"object"==obj_type)for(var k in value)this.set(data_path+"."+k,value[k]);else if("array"==obj_type)for(this.view_target.find('[data-ax-path="'+data_path+'"]').each(function(){("checkbox"==this_type||"radio"==this_type)&&_this.set_els_value(this,this.tagName.toLowerCase(),this_type,value,data_path,"change")}),i=value.length;i--;)this.set(data_path+"["+i+"]",value[i]);else this.view_target.find('[data-ax-path="'+data_path+'"]').each(function(){_this.set_els_value(this,this.tagName.toLowerCase(),this_type,value,data_path,"change")});return this},klass.prototype.get=function(data_path){return"undefined"==typeof data_path?this.model:Function("","return this."+data_path+";").call(this.model)},klass.prototype.onchange=function(data_path,callBack){return this.change_trigger[data_path||"*"]=callBack,this},klass.prototype.change=function(data_path,that){var callBack=this.change_trigger[data_path];callBack&&callBack.call(that,that),"*"!=data_path&&this.change_trigger["*"]&&this.change_trigger["*"].call(that,that)},klass.prototype.onclick=function(data_path,callBack){return this.click_trigger[data_path]=callBack,this},klass.prototype.click=function(data_path,that){var callBack=this.click_trigger[data_path];callBack&&callBack.call(that,that)},klass.prototype.sync_model=function(){},klass.prototype.onupdate=function(data_path,callBack){return this.update_trigger[data_path]=callBack,this},klass.prototype.print_tmpl=function(data_path,tmpl,isInit){var list=Function("","return this."+data_path+";").call(this.model);if(list&&"array"==get_type(list))for(var i=0,l=list.length;l>i;i++){var item=list[i];if(item["@i"]=i,item["@r"]=i,0===i&&(item["@first"]=!0),!item.__DELETED__){var fragdom=$(Mustache.render(tmpl.content,item));fragdom.attr("data-ax-repeat-path",data_path),fragdom.attr("data-ax-repeat-i",item["@i"]),this.bind_event_tmpl(fragdom,data_path),tmpl.container.append(fragdom)}}},klass.prototype.bind_event_tmpl=function(target,data_path){var _this=this,index=target.attr("data-ax-repeat-i"),list=Function("","return this."+data_path+";").call(this.model);target.find("[data-ax-repeat-click]").unbind("click.axbinder").bind("click.axbinder",function(e){var target=axf.get_event_target(e.target,function(el){return el.getAttribute("data-ax-repeat-click")});if(target){var dom=$(target),value=dom.attr("data-ax-repeat-click"),that=(dom.attr("data-ax-repeat-path"),{el:target,jquery:dom,tagname:target.tagName.toLowerCase(),value:value,repeat_path:data_path,item:list[index],item_index:index,item_path:data_path+"["+index+"]"});_this.click(data_path,that)}}),target.find("[data-ax-item-path]").each(function(){var val,dom=$(this),item_path=dom.attr("data-ax-item-path"),mix_path=data_path+"["+index+"]."+item_path,this_type=(this.type||"").toLowerCase();try{val=Function("","return this."+mix_path+";").call(_this.model)}catch(e){_this.onerror&&_this.onerror("not found target [model."+mix_path+"]")}_this.set_els_value(this,this.tagName.toLowerCase(),this_type,val||"",mix_path)}),target.find("[data-ax-item-path]").unbind("change.axbinder").bind("change.axbinder",function(e){var i,checked,hasItem=!1,new_value=[],this_type=(this.type||"").toLowerCase(),dom=$(e.target),item_path=dom.attr("data-ax-item-path"),mix_path=data_path+"["+index+"]."+item_path,origin_value=Function("","return this."+mix_path+";").call(_this.model),value_type=get_type(origin_value),setAllow=!0;if(("object"==value_type||"array"==value_type)&&(setAllow=!1),"checkbox"==this_type){if(target.find('[data-ax-item-path="'+item_path+'"]').length>1){for("array"!=get_type(origin_value)&&(origin_value="undefined"==typeof origin_value||""==origin_value?[]:[].concat(origin_value)),i=origin_value.length,hasItem=!1,checked=this.checked;i--;)origin_value[i]==this.value&&(hasItem=!0);if(checked)hasItem||origin_value.push(this.value);else{for(i=origin_value.length;i--;)origin_value[i]==this.value||new_value.push(origin_value[i]);origin_value=new_value}}else origin_value=this.checked?this.value:"";Function("val","this."+mix_path+" = val;").call(_this.model,origin_value),_this.change(mix_path,{el:this,jquery:dom,tagname:this.tagName.toLowerCase(),value:origin_value})}else setAllow&&(Function("val","this."+mix_path+" = val;").call(_this.model,this.value),_this.change(mix_path,{el:this,jquery:dom,tagname:this.tagName.toLowerCase(),value:this.value}))}),target.find("[data-ax-item-path]").unbind("blur.axbinder").bind("blur.axbinder",function(e){$(e.target).trigger("change")})},klass.prototype.add=function(data_path,item){var list=Function("","return this."+data_path+";").call(this.model),tmpl=this.tmpl[data_path];item["@i"]=list.length,item["@r"]=list.length,item.__ADDED__=!0,Function("val","this."+data_path+".push(val);").call(this.model,item);for(var t in tmpl){var fragdom=$(Mustache.render(tmpl[t].content,item));fragdom.attr("data-ax-repeat-path",data_path),fragdom.attr("data-ax-repeat-i",item["@i"]),this.bind_event_tmpl(fragdom,data_path),tmpl[t].container.append(fragdom)}this.change("*");var callBack=this.update_trigger[data_path];if(callBack){var that={repeat_path:data_path,tmpl:tmpl,list:list};callBack.call(that,that)}return this},klass.prototype.remove=function(data_path,index){var list=Function("","return this."+data_path+";").call(this.model),tmpl=this.tmpl[data_path];"undefined"==typeof index&&(index=list.length-1);var remove_item=list[index];remove_item.__ADDED__?list.splice(index,1):list[index].__DELETED__=!0;for(var t in tmpl)tmpl[t].container.empty(),this.print_tmpl(data_path,tmpl[t]);this.change("*");var callBack=this.update_trigger[data_path];if(callBack){var that={repeat_path:data_path,tmpl:tmpl,list:list};callBack.call(that,that)}return this},klass.prototype.update=function(data_path,index,item){var list=Function("","return this."+data_path+";").call(this.model),tmpl=this.tmpl[data_path];"undefined"!=typeof index&&item&&list.splice(index,1,item);for(var t in tmpl)tmpl[t].container.empty(),this.print_tmpl(data_path,tmpl[t]);this.change("*");var callBack=this.update_trigger[data_path];if(callBack){var that={repeat_path:data_path,tmpl:tmpl,list:list};callBack.call(that,that)}return this},klass.prototype.child_add=function(data_path,index,child_path,child_item){var _list=Function("","return this."+data_path+";").call(this.model),list=Function("","return this."+data_path+"["+index+"]."+child_path+";").call(this.model);child_item.__ADDED__=!0,list.push(child_item),this.update(data_path,index,_list[index])},klass.prototype.child_remove=function(data_path,index,child_path,child_index){var _list=Function("","return this."+data_path+";").call(this.model),list=Function("","return this."+data_path+"["+index+"]."+child_path+";").call(this.model),remove_item=list[child_index];remove_item.__ADDED__?list.splice(child_index,1):list[child_index].__DELETED__=!0,this.update(data_path,index,_list[index])},klass.prototype.child_update=function(data_path,index,child_path,child_index,child_item){var _list=Function("","return this."+data_path+";").call(this.model),list=Function("","return this."+data_path+"["+index+"]."+child_path+";").call(this.model);list[child_index]=child_item,this.update(data_path,index,_list[index])},klass.prototype.child_set=function(data_path,index,child_path,value){var _this=this;return Function("val","this."+data_path+"["+index+"]."+child_path+" = val;").call(this.model,value),this.view_target.find('[data-ax-repeat="'+data_path+'"]').find('[data-ax-repeat-i="'+index+'"]').find('[data-ax-item-path="'+child_path+'"]').each(function(){_this.set_els_value(this,this.tagName.toLowerCase(),(this.type||"").toLowerCase(),value,data_path+"["+index+"]."+child_path)}),this},klass.prototype.focus=function(data_path){this.view_target.find('[data-ax-path="'+data_path+'"]').focus()},klass.prototype.validate=function(){var _this=this,errors=[];return this.view_target.find("[data-ax-path]").each(function(){var dom=$(this),data_path=dom.attr("data-ax-path"),is_validate=dom.attr("data-ax-validate");if(is_validate){var val=Function("","return this."+data_path+";").call(_this.model);"undefined"==typeof val&&(val="");var _val=val.toString(),is_error=!1;"required"==is_validate&&""==_val.trim()?is_error=!0:!/\D.?/g.test(is_validate)&&_val.trim().length<is_validate.number()&&(is_error=!0),is_error&&errors.push({type:is_validate,data_path:data_path,el:this,jquery:dom,value:val})}}),this.view_target.find("[data-ax-repeat-path]").each(function(){var dom=$(this),data_path=dom.attr("data-ax-repeat-path"),repeat_idx=dom.attr("data-ax-repeat-i");dom.find("[data-ax-validate]").each(function(){var dom=$(this),is_validate=dom.attr("data-ax-validate"),item_path=dom.attr("data-ax-item-path"),val=Function("","return this."+data_path+"["+repeat_idx+"]."+item_path+";").call(_this.model);if(is_validate){var is_error=!1;"required"==is_validate&&""==val.trim()?is_error=!0:!/\D.?/g.test(is_validate)&&val.trim().length<is_validate.number()&&(is_error=!0),is_error&&errors.push({type:is_validate,data_path:data_path,el:this,jquery:dom,value:val})}})}),errors.length>0?{error:errors}:{}},klass}();