"use strict";!function(t,e){var a=ax5.util,n=function(){e&&e.call(this);var t,n=this,l=1;this.target=null,this.selection=[],this.selectionMap={},this.selectableMap={},this.markerMap={},this.printedDay={start:"",end:""},this.config={clickEventName:"click",theme:"default",mode:"day",dateFormat:"yyyy-mm-dd",displayDate:new Date,animateTime:250,dimensions:{controlHeight:"40",controlButtonWidth:"40",colHeadHeight:"30",itemPadding:2},lang:{yearHeading:"Choose the year",monthHeading:"Choose the month",yearTmpl:"%s",months:["JAN","FEB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","NOV","DEC"],dayTmpl:"%s"},multipleSelect:!1,selectMode:"day",defaultMarkerTheme:"holiday"},t=this.config;var i=function(t,e){t&&t.onStateChanged?t.onStateChanged.call(e,e):this.onStateChanged&&this.onStateChanged.call(e,e),e=null},s=function(){return'\n                <div class="ax5-ui-calendar {{theme}}" data-calendar-els="root" onselectstart="return false;">\n                    {{#control}}\n                    <div class="calendar-control" data-calendar-els="control" style="{{controlCSS}}">\n                        <a class="date-move-left" data-calendar-move="left" style="{{controlButtonCSS}}">{{{left}}}</a>\n                        <div class="date-display" data-calendar-els="control-display" style="{{controlCSS}}"></div>\n                        <a class="date-move-right" data-calendar-move="right" style="{{controlButtonCSS}}">{{{right}}}</a>\n                    </div>\n                    {{/control}}\n                    <div class="calendar-body" data-calendar-els="body"></div>\n                </div>\n                '},r=function(){var e=jQuery.extend(!0,{},t,{controlCSS:{},controlButtonCSS:{}}),n=s();e.controlButtonCSS.height=e.controlCSS.height=a.cssNumber(t.dimensions.controlHeight),e.controlButtonCSS["line-height"]=e.controlCSS["line-height"]=a.cssNumber(t.dimensions.controlHeight),e.controlButtonCSS.width=a.cssNumber(t.dimensions.controlHeight),e.controlCSS=a.css(e.controlCSS),e.controlButtonCSS=a.css(e.controlButtonCSS);try{return ax5.mustache.render(n,e)}finally{e=null,n=null}},d=function(){return'\n                <table data-calendar-table="day" cellpadding="0" cellspacing="0" style="width:100%;">\n                    <thead>\n                        <tr>\n                        {{#weekNames}}\n                            <td class="calendar-col-{{@i}}" style="height: {{colHeadHeight}}">\n                            {{label}}\n                            </td>\n                        {{/weekNames}}\n                        </tr>\n                    </thead>\n                    <tbody>\n                        <tr>\n                            {{#list}}    \n                            {{#isStartOfWeek}}\n                            {{^@first}}\n                        </tr>\n                        <tr>\n                            {{/@first}}\n                            {{/isStartOfWeek}}\n                            <td class="calendar-col-{{@i}}" style="{{itemStyles}}">\n                                <a class="calendar-item-day {{addClass}}" data-calendar-item-date="{{thisDate}}">\n                                    <span class="addon"></span>\n                                    {{thisDataLabel}}\n                                    <span class="lunar"></span>\n                                </a>\n                            </td>\n                            {{/list}}\n                        </tr>\n                    </tbody>\n                </table>\n                '},o=function(){return'\n                <table data-calendar-table="month" cellpadding="0" cellspacing="0" style="width:100%;">\n                    <thead>\n                        <tr>\n                            <td class="calendar-col-0" colspan="3" style="height: {{colHeadHeight}}">\n                            {{colHeadLabel}}\n                            </td>\n                        </tr>\n                    </thead>\n                    <tbody>\n                        <tr>\n                            {{#list}}    \n                            {{#isStartOfRow}}\n                            {{^@first}}\n                        </tr>\n                        <tr>\n                            {{/@first}}\n                            {{/isStartOfRow}}\n                            <td class="calendar-col-{{@i}}" style="{{itemStyles}}">\n                                <a class="calendar-item-month {{addClass}}" data-calendar-item-month="{{thisMonth}}">\n                                    <span class="addon"></span>\n                                    {{thisMonthLabel}}\n                                    <span class="lunar"></span>\n                                </a>\n                            </td>\n                            {{/list}}\n                        </tr>\n                    </tbody>\n                </table>\n                '},c=function(){return'\n                <table data-calendar-table="year" cellpadding="0" cellspacing="0" style="width:100%;">\n                    <thead>\n                        <tr>\n                            <td class="calendar-col-0" colspan="4" style="height: {{colHeadHeight}}">\n                            {{colHeadLabel}}\n                            </td>\n                        </tr>\n                    </thead>\n                    <tbody>\n                        <tr>\n                            {{#list}}    \n                            {{#isStartOfRow}}\n                            {{^@first}}\n                        </tr>\n                        <tr>\n                            {{/@first}}\n                            {{/isStartOfRow}}\n                            <td class="calendar-col-{{@i}}" style="{{itemStyles}}">\n                                <a class="calendar-item-year {{addClass}}" data-calendar-item-year="{{thisYear}}">\n                                    <span class="addon"></span>\n                                    {{thisYearLabel}}\n                                    <span class="lunar"></span>\n                                </a>\n                            </td>\n                            {{/list}}\n                        </tr>\n                    </tbody>\n                </table>\n                '},h=function(){var e,n,l=a.date(t.displayDate),i="",s="";return t.control&&("day"==t.mode||"d"==t.mode?(i=t.control.yearTmpl?t.control.yearTmpl.replace("%s",l.getFullYear()):l.getFullYear(),s=t.control.monthTmpl?t.control.monthTmpl.replace("%s",t.lang.months[l.getMonth()]):t.lang.months[l.getMonth()],this.$["control-display"].html(function(){return t.control.yearFirst?'<span data-calendar-display="year">'+i+'</span><span data-calendar-display="month">'+s+"</span>":'<span data-calendar-display="month">'+s+'</span><span data-calendar-display="year">'+i+"</span>"}())):"month"==t.mode||"m"==t.mode?(i=t.control.yearTmpl?t.control.yearTmpl.replace("%s",l.getFullYear()):l.getFullYear(),this.$["control-display"].html('<span data-calendar-display="year">'+i+"</span>")):("year"==t.mode||"y"==t.mode)&&(e=t.control.yearTmpl?t.control.yearTmpl.replace("%s",l.getFullYear()-10):l.getFullYear()-10,n=t.control.yearTmpl?t.control.yearTmpl.replace("%s",Number(l.getFullYear())+9):Number(l.getFullYear())+9,this.$["control-display"].html(e+" ~ "+n)),this.$["control-display"].find("[data-calendar-display]").on(t.clickEventName,function(t){var e,n=a.findParentNode(t.target,function(t){return t.getAttribute("data-calendar-display")?!0:void 0});n&&(e=n.getAttribute("data-calendar-display"),this.changeMode(e)),n=null,e=null}.bind(this))),l=null,i=null,s=null,e=null,n=null,this},u=function(e){var l,s,r,o,c=a.date(e),u=new Date(c.getFullYear(),c.getMonth(),1,12),m=t.displayDate,y=function(){var t=u.getDay();0==t&&(t=7);try{return a.date(u,{add:{d:-t}})}finally{t=null}}(),g=c.getMonth(),p={},b=this.$.body.width(),v=Math.floor(b*(6/7)),D=d();for(t.dimensions.height&&(v=a.number(t.dimensions.height)-a.number(t.dimensions.colHeadHeight)),p.height=Math.floor(v/6)-2*a.number(t.dimensions.itemPadding)+"px",p["line-height"]=p.height,p.padding=a.cssNumber(t.dimensions.itemPadding),o={weekNames:[].concat(ax5.info.weekNames),list:[]},o.weekNames.forEach(function(e){e.colHeadHeight=a.cssNumber(t.dimensions.colHeadHeight)}),l=y,s=0;6>s;){for(r=0;7>r;){var S=""+a.date(l,{"return":t.dateFormat}),M={isStartOfWeek:0==r,thisDate:""+S,thisDataLabel:t.lang.dayTmpl.replace("%s",l.getDate()),itemStyles:a.css(p),addClass:function(){return t.selectable?n.selectableMap[S]?l.getMonth()==g?"live":"":"disable":l.getMonth()==g?S==a.date(m,{"return":"yyyymmdd"})?"focus":"live":""}()+" "+function(){return n.markerMap[S]?n.markerMap[S].theme||t.defaultMarkerTheme:""}()+" "+function(){return n.selectionMap[S]?"selected-day":""}()};o.list.push(M),r++,l=a.date(l,{add:{d:1}}),S=null,M=null}s++}this.$.body.html(ax5.mustache.render(D,o)),this.$.body.find("[data-calendar-item-date]").on(t.clickEventName,function(t){t=t||window.event,f.call(n,t,"date"),a.stopEvent(t)}),this.printedDay={start:y,end:l},i.call(this,null,{self:this,action:"printDay",printedDay:this.printedDay}),h.call(this),c=null,u=null,m=null,y=null,l=null,g=null,p=null,s=null,r=null,b=null,v=null,o=null,D=null},m=function(e){var l,s,r,d,c,u=a.date(e),m=u.getMonth(),y={},g=this.$.body.width(),p=Math.floor(g*(6/7)),b=o();for(t.dimensions.height&&(p=a.number(t.dimensions.height)-a.number(t.dimensions.colHeadHeight)),y.height=Math.floor(p/4)-2*a.number(t.dimensions.itemPadding)+"px",y["line-height"]=y.height,y.padding=a.cssNumber(t.dimensions.itemPadding),c={colHeadHeight:a.cssNumber(t.dimensions.colHeadHeight),colHeadLabel:t.lang.monthHeading,list:[]},d=0,r=0,l=0;4>l;){for(s=0;3>s;){var v={row:l,col:s,isStartOfRow:0==s,thisMonth:u.getFullYear()+"-"+a.setDigit(r+1,2)+"-"+a.setDigit(u.getDate(),2),thisMonthLabel:t.lang.months[r],itemStyles:a.css(y),addClass:function(){return t.selectable?n.selectableMap[r]?"live":"disable":"live"}()+" "+function(){return r==m?"focus":""}()+" "+function(){return n.markerMap[r]?n.markerMap[r].theme||t.defaultMarkerTheme:""}()};c.list.push(v),r++,s++,v=null}l++}this.$.body.html(ax5.mustache.render(b,c)),this.$.body.find("[data-calendar-item-month]").on(t.clickEventName,function(t){t=t||window.event,f.call(n,t,"month"),a.stopEvent(t)}),this.printedDay={start:u.getFullYear()+"-"+a.setDigit(d+1,2),end:u.getFullYear()+"-"+a.setDigit(r,2)},i.call(this,null,{self:this,action:"printMonth",printedDay:this.printedDay}),h.call(this),u=null,m=null,y=null,l=null,s=null,r=null,d=null,g=null,p=null,c=null,b=null},y=function(e){var l,s,r,d,o,u=a.date(e),m=u.getFullYear(),y={},g=this.$.body.width(),p=Math.floor(g*(6/7)),b=c();for(t.dimensions.height&&(p=a.number(t.dimensions.height)-a.number(t.dimensions.colHeadHeight)),y.height=Math.floor(p/5)-2*a.number(t.dimensions.itemPadding)+"px",y["line-height"]=y.height,y.padding=a.cssNumber(t.dimensions.itemPadding),o={colHeadHeight:a.cssNumber(t.dimensions.colHeadHeight),colHeadLabel:t.lang.yearHeading,list:[]},d=m-10,r=m-10,l=0;5>l;){for(s=0;4>s;){var v={row:l,col:s,isStartOfRow:0==s,thisYear:r+"-"+a.setDigit(u.getMonth()+1,2)+"-"+a.setDigit(u.getDate(),2),thisYearLabel:t.lang.yearTmpl.replace("%s",r),itemStyles:a.css(y),addClass:function(){return t.selectable?n.selectableMap[r]?"live":"disable":"live"}()+" "+function(){return r==m?"focus":""}()+" "+function(){return n.selectableMap[r]?n.selectableMap[r].theme||t.defaultMarkerTheme:""}()};o.list.push(v),r++,s++,v=null}l++}this.$.body.html(ax5.mustache.render(b,o)),this.$.body.find("[data-calendar-item-year]").on(t.clickEventName,function(t){t=t||window.event,f.call(this,t,"year"),a.stopEvent(t)}),this.printedDay={start:d,end:r-1},i.call(this,null,{self:this,action:"printYear",printedDay:this.printedDay}),h.call(this),u=null,m=null,y=null,l=null,s=null,r=null,d=null,g=null,p=null,o=null,b=null},f=function(e,i,s,r){var d,o,c;i=i||"date",s=a.findParentNode(e.target,function(t){return t.getAttribute("data-calendar-item-"+i)?!0:void 0}),s&&(r=s.getAttribute("data-calendar-item-"+i),o=a.date(r,{"return":t.dateFormat}),c=!0,l=t.multipleSelect?a.isNumber(t.multipleSelect)?t.multipleSelect:2:1,t.selectable&&(n.selectableMap[o]||(c=!1)),"date"==i?c&&(n.selection.length>=l&&(d=n.selection.splice(0,n.selection.length-(l-1)),d.forEach(function(e){n.$.body.find('[data-calendar-item-date="'+a.date(e,{"return":t.dateFormat})+'"]').removeClass("selected-day")})),jQuery(s).addClass("selected-day"),n.selection.push(r),n.onClick&&n.onClick.call({self:this,date:r,target:this.target,dateElement:s})):"month"==i?"month"==t.selectMode?c&&(n.selection.length>=l&&(d=n.selection.splice(0,n.selection.length-(l-1)),d.forEach(function(t){n.$.body.find('[data-calendar-item-month="'+a.date(t,{"return":"yyyy-mm-dd"})+'"]').removeClass("selected-month")})),jQuery(s).addClass("selected-month"),n.selection.push(r),n.onClick&&n.onClick.call({self:this,date:r,target:this.target,dateElement:s})):n.changeMode("day",r):"year"==i&&("year"==t.selectMode?c&&(n.selection.length>=l&&(d=n.selection.splice(0,n.selection.length-(l-1)),d.forEach(function(t){n.$.body.find('[data-calendar-item-year="'+a.date(t,{"return":"yyyy-mm-dd"})+'"]').removeClass("selected-year")})),jQuery(s).addClass("selected-year"),n.selection.push(r),n.onClick&&n.onClick.call({self:this,date:r,target:this.target,dateElement:s})):n.changeMode("month",r))),i=null,s=null,r=null,d=null,o=null,c=null},g=function(e,n,l){n=a.findParentNode(e.target,function(t){return t.getAttribute("data-calendar-move")?!0:void 0}),n&&(l=n.getAttribute("data-calendar-move"),"day"==t.mode?("left"==l?t.displayDate=a.date(t.displayDate,{add:{m:-1}}):t.displayDate=a.date(t.displayDate,{add:{m:1}}),u.call(this,t.displayDate)):"month"==t.mode?("left"==l?t.displayDate=a.date(t.displayDate,{add:{y:-1}}):t.displayDate=a.date(t.displayDate,{add:{y:1}}),m.call(this,t.displayDate)):"year"==t.mode&&("left"==l?t.displayDate=a.date(t.displayDate,{add:{y:-10}}):t.displayDate=a.date(t.displayDate,{add:{y:10}}),y.call(this,t.displayDate))),n=null,l=null},p=function(){setTimeout(function(){if("day"===t.mode||"d"===t.mode)for(var e in this.markerMap)this.$.body.find('[data-calendar-item-date="'+e+'"]').addClass(this.markerMap[e].theme||t.defaultMarkerTheme)}.bind(this))},b=function(){setTimeout(function(){for(var t in this.selectionMap)this.$.body.find('[data-calendar-item-date="'+t+'"]').addClass("selected-day")}.bind(this))};this.init=function(){this.onStateChanged=t.onStateChanged,this.onClick=t.onClick,t.target||console.log(ax5.info.getError("ax5calendar","401","setConfig")),this.target=jQuery(t.target),t.displayDate=a.date(t.displayDate),this.target.html(r.call(this)),this.$={root:this.target.find('[data-calendar-els="root"]'),control:this.target.find('[data-calendar-els="control"]'),"control-display":this.target.find('[data-calendar-els="control-display"]'),body:this.target.find('[data-calendar-els="body"]')},t.control&&this.$.control.find("[data-calendar-move]").on(t.clickEventName,function(t){g.call(this,t||window.event)}.bind(this)),t.selection&&this.setSelection(t.selection,!1),t.selectable&&this.setSelectable(t.selectable,!1),t.marker&&this.setMarker(t.marker,!1),setTimeout(function(){"day"===t.mode||"d"===t.mode?u.call(this,t.displayDate):"month"===t.mode||"m"===t.mode?m.call(this,t.displayDate):("year"===t.mode||"y"===t.mode)&&y.call(this,t.displayDate)}.bind(this))},this.changeMode=function(e,a){return"undefined"!=typeof a&&(t.displayDate=a),e&&(t.mode=e),this.$.body.removeClass("fadein").addClass("fadeout"),setTimeout(function(){"day"==t.mode||"d"==t.mode?u.call(this,t.displayDate):"month"==t.mode||"m"==t.mode?m.call(this,t.displayDate):("year"==t.mode||"y"==t.mode)&&y.call(this,t.displayDate),this.$.body.removeClass("fadeout").addClass("fadein")}.bind(this),t.animateTime),this},this.setSelection=function(){n.selectionMap={};var e={arr:function(e,l,i){return l={},a.isArray(e)?(n.selection=e=e.splice(0,i),e.forEach(function(e){a.isDate(e)&&(e=a.date(e,{"return":t.dateFormat})),l[e]=!0}),l):l}};return function(n,i){var s={};if(l=t.multipleSelect?a.isNumber(t.multipleSelect)?t.multipleSelect:2:1,t.selection=n){if(!a.isArray(n))return this;s=e.arr(n,{},l)}this.selectionMap=jQuery.extend({},s),i!==!1&&b.call(this),s=null}}(),this.getSelection=function(){return this.selection},this.setSelectable=function(){n.selectableMap={};var e={arr:function(e,n){return n={},a.isArray(e)?(e.forEach(function(e){a.isDate(e)&&(e=a.date(e,{"return":t.dateFormat})),n[e]=!0}),n):n},obj:function(t,e){if(e={},a.isArray(t))return e;if(t.range)return e;for(var n in t)e[n]=t[n];return e},range:function(e,n){return n={},a.isArray(e)?n:e.range?(e.range.forEach(function(e){if(a.isDateFormat(e.from)&&a.isDateFormat(e.to))for(var l=a.date(e.from);l<=a.date(e.to);l.setDate(l.getDate()+1))n[a.date(l,{"return":t.dateFormat})]=!0;else for(var i=e.from;i<=e.to;i++)n[i]=!0}),n):n}};return function(n,l){var i,s={};if(t.selectable=n)if(a.isArray(n))s=e.arr(n);else{for(i in e)if(n[i]){s=e[i](n);break}0===Object.keys(s).length&&(s=e.obj(n))}this.selectableMap=s,l!==!1&&this.changeMode()}}(),this.setMarker=function(){n.markerMap={};var e={obj:function(t,e){if(e={},a.isArray(t))return e;if(t.range)return e;for(var n in t)e[n]=t[n];return t=null,e},range:function(e,n){return n={},a.isArray(e)?n:e.range?(e.range.forEach(function(e){if(a.isDateFormat(e.from)&&a.isDateFormat(e.to))for(var l=a.date(e.from);l<=a.date(e.to);l.setDate(l.getDate()+1))n[a.date(l,{"return":t.dateFormat})]={theme:e.theme,label:e.label};else for(var i=e.from;i<=e.to;i++)n[i]={theme:e.theme,label:e.label}}),e=null,n):n}};return function(a,n){var l,i={};if(t.marker=a){for(l in e)if(a[l]){i=e[l](a);break}0===Object.keys(i).length&&(i=e.obj(a))}return this.markerMap=i,n!==!1&&p.call(this),this}}(),this.main=function(){arguments&&a.isObject(arguments[0])&&this.setConfig(arguments[0])}.apply(this,arguments)};t.calendar=function(){return a.isFunction(e)&&(n.prototype=new e),n}()}(ax5.ui,ax5.ui.root);